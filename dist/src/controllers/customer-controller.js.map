{"version":3,"sources":["../../../src/controllers/customer-controller.ts"],"sourcesContent":["import { ICustomer } from \"@/interfaces/customer-interface\";\nimport prisma from \"@/models/prisma\";\nimport createError from \"@/utils/create-error\";\nimport { NextFunction, Request, Response } from \"express\";\n\nexport const createCustomer = async (\n\treq: Request,\n\tres: Response,\n\tnext: NextFunction\n) => {\n\ttry {\n\t\tconst { role } = req.user;\n\n\t\tif (role !== \"ADMIN\") {\n\t\t\treturn next(createError(\"not admin\", 401));\n\t\t}\n\n\t\tconst values: ICustomer = req.body;\n\n\t\tconst result = await prisma.customer.create({\n\t\t\tdata: values,\n\t\t});\n\n\t\tres.status(201).json({ message: \"ok\", result });\n\t} catch (error) {\n\t\tnext(error);\n\t}\n};\n\nexport const getAllCustomer = async (\n\treq: Request,\n\tres: Response,\n\tnext: NextFunction\n) => {\n\ttry {\n\t\tconst { role } = req.user;\n\n\t\tif (role !== \"ADMIN\") {\n\t\t\treturn next(createError(\"not admin\", 200));\n\t\t}\n\n\t\tconst result = await prisma.customer.findMany({\n\t\t\tinclude: {\n\t\t\t\tzone: true,\n\t\t\t},\n\t\t});\n\n\t\tres.status(200).json({ message: \"ok\", result });\n\t} catch (error) {\n\t\tnext(error);\n\t}\n};\n\nexport const editCustomer = async (\n\treq: Request,\n\tres: Response,\n\tnext: NextFunction\n) => {\n\ttry {\n\t\tconst { role } = req.user;\n\t\tconst { customerId } = req.query;\n\t\tconst {\n\t\t\tid_passpost,\n\t\t\tfirstname,\n\t\t\tlastname,\n\t\t\tphone_number,\n\t\t\thouse_number,\n\t\t\taddress,\n\t\t\tzoneId,\n\t\t} = req.body;\n\n\t\tif (role !== \"ADMIN\") {\n\t\t\treturn next(createError(\"not admin\", 401));\n\t\t}\n\n\t\tconst findCustomer = await prisma.customer.findUnique({\n\t\t\twhere: {\n\t\t\t\tid: Number(customerId),\n\t\t\t},\n\t\t});\n\n\t\tconst customer = await prisma.customer.update({\n\t\t\twhere: {\n\t\t\t\tid: findCustomer.id,\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\tid_passpost,\n\t\t\t\tfirstname,\n\t\t\t\tlastname,\n\t\t\t\tphone_number,\n\t\t\t\thouse_number,\n\t\t\t\taddress,\n\t\t\t\tzoneId,\n\t\t\t},\n\t\t});\n\t\tres.status(201).json({ message: \"ok\", customer });\n\t} catch (error) {\n\t\tnext(error);\n\t}\n};\n"],"names":["createCustomer","editCustomer","getAllCustomer","req","res","next","role","user","createError","values","body","result","prisma","customer","create","data","status","json","message","error","findMany","include","zone","customerId","query","id_passpost","firstname","lastname","phone_number","house_number","address","zoneId","findCustomer","findUnique","where","id","Number","update"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAKaA,cAAc;eAAdA;;IAgDAC,YAAY;eAAZA;;IAxBAC,cAAc;eAAdA;;;iDA5BM;sDACK;;;;;;AAGjB,MAAMF,iBAAiB,OAC7BG,KACAC,KACAC;IAEA,IAAI;QACH,MAAM,EAAEC,IAAI,EAAE,GAAGH,IAAII,IAAI;QAEzB,IAAID,SAAS,SAAS;YACrB,OAAOD,KAAKG,IAAAA,oBAAW,EAAC,aAAa;QACtC;QAEA,MAAMC,SAAoBN,IAAIO,IAAI;QAElC,MAAMC,SAAS,MAAMC,eAAM,CAACC,QAAQ,CAACC,MAAM,CAAC;YAC3CC,MAAMN;QACP;QAEAL,IAAIY,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;YAAMP;QAAO;IAC9C,EAAE,OAAOQ,OAAO;QACfd,KAAKc;IACN;AACD;AAEO,MAAMjB,iBAAiB,OAC7BC,KACAC,KACAC;IAEA,IAAI;QACH,MAAM,EAAEC,IAAI,EAAE,GAAGH,IAAII,IAAI;QAEzB,IAAID,SAAS,SAAS;YACrB,OAAOD,KAAKG,IAAAA,oBAAW,EAAC,aAAa;QACtC;QAEA,MAAMG,SAAS,MAAMC,eAAM,CAACC,QAAQ,CAACO,QAAQ,CAAC;YAC7CC,SAAS;gBACRC,MAAM;YACP;QACD;QAEAlB,IAAIY,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;YAAMP;QAAO;IAC9C,EAAE,OAAOQ,OAAO;QACfd,KAAKc;IACN;AACD;AAEO,MAAMlB,eAAe,OAC3BE,KACAC,KACAC;IAEA,IAAI;QACH,MAAM,EAAEC,IAAI,EAAE,GAAGH,IAAII,IAAI;QACzB,MAAM,EAAEgB,UAAU,EAAE,GAAGpB,IAAIqB,KAAK;QAChC,MAAM,EACLC,WAAW,EACXC,SAAS,EACTC,QAAQ,EACRC,YAAY,EACZC,YAAY,EACZC,OAAO,EACPC,MAAM,EACN,GAAG5B,IAAIO,IAAI;QAEZ,IAAIJ,SAAS,SAAS;YACrB,OAAOD,KAAKG,IAAAA,oBAAW,EAAC,aAAa;QACtC;QAEA,MAAMwB,eAAe,MAAMpB,eAAM,CAACC,QAAQ,CAACoB,UAAU,CAAC;YACrDC,OAAO;gBACNC,IAAIC,OAAOb;YACZ;QACD;QAEA,MAAMV,WAAW,MAAMD,eAAM,CAACC,QAAQ,CAACwB,MAAM,CAAC;YAC7CH,OAAO;gBACNC,IAAIH,aAAaG,EAAE;YACpB;YACApB,MAAM;gBACLU;gBACAC;gBACAC;gBACAC;gBACAC;gBACAC;gBACAC;YACD;QACD;QACA3B,IAAIY,MAAM,CAAC,KAAKC,IAAI,CAAC;YAAEC,SAAS;YAAML;QAAS;IAChD,EAAE,OAAOM,OAAO;QACfd,KAAKc;IACN;AACD"}